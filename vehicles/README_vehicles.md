# Проект базы данных транспортных средств

## Обзор проекта

Этот проект реализует SQL базу данных для хранения и управления информацией о различных типах транспортных средств:
автомобилях, мотоциклах и велосипедах. База данных разработана для демонстрации навыков SQL, включая создание таблиц,
определение связей, вставку данных и выполнение сложных запросов.

## Цели проекта

- Создать нормализованную схему базы данных для хранения информации о транспортных средствах
- Реализовать связи между различными типами транспортных средств
- Продемонстрировать возможности SQL-запросов для извлечения данных с различными критериями фильтрации
- Показать возможность объединения данных из нескольких таблиц с использованием joins и unions

## Структура базы данных

База данных состоит из четырех основных таблиц:

### 1. Таблица Vehicle (Транспортное средство)

Основная таблица, которая хранит общую информацию обо всех транспортных средствах:

- `maker`: Производитель транспортного средства (например, Toyota, Honda)
- `model`: Уникальный идентификатор модели (первичный ключ)
- `type`: Тип транспортного средства (Car, Motorcycle или Bicycle)

### 2. Таблица Car (Автомобиль)

Хранит информацию, специфичную для автомобилей:

- `vin`: Идентификационный номер автомобиля (первичный ключ)
- `model`: Внешний ключ, ссылающийся на таблицу Vehicle
- `engine_capacity`: Объем двигателя в литрах
- `horsepower`: Мощность двигателя в лошадиных силах
- `price`: Цена в долларах
- `transmission`: Тип трансмиссии (Automatic или Manual)

### 3. Таблица Motorcycle (Мотоцикл)

Хранит информацию, специфичную для мотоциклов:

- `vin`: Идентификационный номер мотоцикла (первичный ключ)
- `model`: Внешний ключ, ссылающийся на таблицу Vehicle
- `engine_capacity`: Объем двигателя в литрах
- `horsepower`: Мощность двигателя в лошадиных силах
- `price`: Цена в долларах
- `type`: Тип мотоцикла (Sport, Cruiser или Touring)

### 4. Таблица Bicycle (Велосипед)

Хранит информацию, специфичную для велосипедов:

- `serial_number`: Уникальный идентификатор (первичный ключ)
- `model`: Внешний ключ, ссылающийся на таблицу Vehicle
- `gear_count`: Количество передач
- `price`: Цена в долларах
- `type`: Тип велосипеда (Mountain, Road или Hybrid)

## Связи между сущностями

- Каждое транспортное средство имеет уникальный идентификатор модели
- Каждый конкретный тип транспортного средства (Car, Motorcycle, Bicycle) ссылается на основную таблицу Vehicle через
  поле model
- База данных обеспечивает ссылочную целостность через ограничения внешнего ключа

## Реализованная функциональность

### Инициализация базы данных (init.sql)

- Создание таблиц с соответствующими ограничениями
- Вставка примеров данных для всех типов транспортных средств

### Запрос 1: Спортивные мотоциклы (1.sql)

Этот запрос находит все спортивные мотоциклы со следующими характеристиками:

- Мощность более 150 лошадиных сил
- Цена менее $20,000
- Тип Sport
- Результаты отсортированы по мощности в порядке убывания

```sql
SELECT v.maker, v.model
FROM vehicle AS v
         JOIN motorcycle AS m ON m.model = v.model
WHERE m.horsepower > 150
  AND m.price < 20000
  AND m.type = 'Sport'
ORDER BY m.horsepower DESC;
```

Этот запрос объединяет таблицы vehicle и motorcycle по полю model, затем фильтрует результаты по трем условиям: мощность
больше 150 л.с., цена меньше 20000 долларов и тип мотоцикла 'Sport'. Результаты сортируются по мощности в порядке
убывания.

### Запрос 2: Комбинированный запрос по транспортным средствам (2.sql)

Этот сложный запрос извлекает информацию о различных типах транспортных средств на основе определенных критериев:

1. Автомобили с:
    - Мощностью более 150 лошадиных сил
    - Объемом двигателя менее 3 литров
    - Ценой менее $35,000

2. Мотоциклы с:
    - Мощностью более 150 лошадиных сил
    - Объемом двигателя менее 1.5 литров
    - Ценой менее $20,000

3. Велосипеды с:
    - Более чем 18 передачами
    - Ценой менее $4,000

Результаты объединяются с помощью UNION ALL и сортируются по мощности в порядке убывания (с велосипедами в конце, так
как у них NULL значения мощности).

```sql
SELECT v.maker,
       v.model,
       c.horsepower,
       c.engine_capacity,
       'Car' AS vehicle_type
FROM Vehicle v
         JOIN
     Car c ON v.model = c.model
WHERE c.horsepower > 150
  AND c.engine_capacity < 3
  AND c.price < 35000

UNION ALL

SELECT v.maker,
       v.model,
       m.horsepower,
       m.engine_capacity,
       'Motorcycle' AS vehicle_type
FROM Vehicle v
         JOIN
     Motorcycle m ON v.model = m.model
WHERE m.horsepower > 150
  AND m.engine_capacity < 1.5
  AND m.price < 20000

UNION ALL

SELECT v.maker,
       v.model,
       NULL      AS horsepower,
       NULL      AS engine_capacity,
       'Bicycle' AS vehicle_type
FROM Vehicle v
         JOIN
     Bicycle b ON v.model = b.model
WHERE b.gear_count > 18
  AND b.price < 4000

ORDER BY horsepower DESC NULLS LAST;
```

Этот запрос состоит из трех частей, объединенных с помощью UNION ALL:

1. Первая часть выбирает автомобили с мощностью более 150 л.с., объемом двигателя менее 3 литров и ценой менее 35000
   долларов.
2. Вторая часть выбирает мотоциклы с мощностью более 150 л.с., объемом двигателя менее 1.5 литров и ценой менее 20000
   долларов.
3. Третья часть выбирает велосипеды с количеством передач более 18 и ценой менее 4000 долларов.

Для каждого транспортного средства выводится производитель, модель, мощность, объем двигателя и тип транспортного
средства. Для велосипедов значения мощности и объема двигателя установлены как NULL. Результаты сортируются по мощности
в порядке убывания, при этом велосипеды (с NULL значениями мощности) отображаются в конце списка.

### Запрос 3: Статистика по типам транспортных средств (3.sql)

Этот запрос вычисляет среднюю цену и мощность для каждого производителя, сгруппированные по типу транспортного средства:

- Для автомобилей и мотоциклов вычисляется средняя цена и средняя мощность
- Для велосипедов вычисляется только средняя цена (мощность не применима)
- Результаты включают количество транспортных средств каждого типа для каждого производителя
- Результаты сортируются сначала по типу транспортного средства (автомобили, затем мотоциклы, затем велосипеды), а затем по средней цене в порядке убывания

```sql
WITH VehicleStats AS (
    -- Статистика для автомобилей
    SELECT 
        v.maker,
        v.type AS vehicle_type,
        AVG(c.price) AS avg_price,
        AVG(c.horsepower) AS avg_horsepower,
        COUNT(*) AS vehicle_count
    FROM 
        Vehicle v
    JOIN 
        Car c ON v.model = c.model
    GROUP BY 
        v.maker, v.type

    UNION ALL

    -- Статистика для мотоциклов
    SELECT 
        v.maker,
        v.type AS vehicle_type,
        AVG(m.price) AS avg_price,
        AVG(m.horsepower) AS avg_horsepower,
        COUNT(*) AS vehicle_count
    FROM 
        Vehicle v
    JOIN 
        Motorcycle m ON v.model = m.model
    GROUP BY 
        v.maker, v.type

    UNION ALL

    -- Статистика для велосипедов (без мощности)
    SELECT 
        v.maker,
        v.type AS vehicle_type,
        AVG(b.price) AS avg_price,
        NULL AS avg_horsepower,
        COUNT(*) AS vehicle_count
    FROM 
        Vehicle v
    JOIN 
        Bicycle b ON v.model = b.model
    GROUP BY 
        v.maker, v.type
)

SELECT 
    maker,
    vehicle_type,
    ROUND(avg_price, 2) AS avg_price,
    ROUND(avg_horsepower, 0) AS avg_horsepower,
    vehicle_count
FROM 
    VehicleStats
ORDER BY 
    CASE 
        WHEN vehicle_type = 'Car' THEN 1
        WHEN vehicle_type = 'Motorcycle' THEN 2
        WHEN vehicle_type = 'Bicycle' THEN 3
    END,
    avg_price DESC;
```

Этот запрос использует Common Table Expression (CTE) для объединения статистики по каждому типу транспортного средства. Для каждого производителя и типа транспортного средства вычисляется средняя цена, средняя мощность (для автомобилей и мотоциклов) и количество транспортных средств. Результаты сортируются по типу транспортного средства и затем по средней цене в порядке убывания.

#### Ожидаемые результаты для запроса 2

На основе примеров данных запрос должен вернуть:

1. **Toyota Camry** (Автомобиль):
    - Мощность: 203 л.с.
    - Объем двигателя: 2.5 л
    - Соответствует критериям: мощность > 150 л.с., объем < 3 л, цена = $24,000 < $35,000

2. **Yamaha YZF-R1** (Мотоцикл):
    - Мощность: 200 л.с.
    - Объем двигателя: 1.0 л
    - Соответствует критериям: мощность > 150 л.с., объем < 1.5 л, цена = $17,000 < $20,000

3. **Trek Domane** (Велосипед):
    - Количество передач: 22
    - Соответствует критериям: передач > 18, цена = $3,500 < $4,000

4. **Giant Defy** (Велосипед):
    - Количество передач: 20
    - Соответствует критериям: передач > 18, цена = $3,000 < $4,000

Записи будут отсортированы в порядке, показанном выше, с автомобилями и мотоциклами сначала (отсортированными по
мощности) и велосипедами в конце.

#### Ожидаемые результаты для запроса 3

На основе примеров данных запрос должен вернуть:

1. **Автомобили**:
   - Toyota: средняя цена $24,000.00, средняя мощность 203 л.с., количество: 1
   - Honda: средняя цена $22,000.00, средняя мощность 158 л.с., количество: 1
   - Ford: средняя цена $55,000.00, средняя мощность 450 л.с., количество: 1

2. **Мотоциклы**:
   - Yamaha: средняя цена $17,000.00, средняя мощность 200 л.с., количество: 1
   - Harley-Davidson: средняя цена $12,000.00, средняя мощность 70 л.с., количество: 1
   - Kawasaki: средняя цена $14,000.00, средняя мощность 150 л.с., количество: 1

3. **Велосипеды**:
   - Trek: средняя цена $3,500.00, мощность: NULL, количество: 1
   - Giant: средняя цена $3,000.00, мощность: NULL, количество: 1
   - Specialized: средняя цена $4,000.00, мощность: NULL, количество: 1

Результаты сортируются сначала по типу транспортного средства (автомобили, затем мотоциклы, затем велосипеды), а затем по средней цене в порядке убывания.

## Инструкции по запуску и тестированию

### Предварительные требования

- Любая система управления базами данных SQL (PostgreSQL, MySQL, SQLite и т.д.)
- SQL-клиент или интерфейс командной строки

### Шаги настройки

1. Создайте новую базу данных (если требуется вашей системой управления базами данных)
2. Запустите скрипт инициализации:
   ```
   psql -d your_database -f vehicles/init.sql
   ```
   или эквивалентную команду для вашей системы управления базами данных

3. Проверьте, что данные были вставлены правильно:
   ```sql
   SELECT * FROM Vehicle;
   SELECT * FROM Car;
   SELECT * FROM Motorcycle;
   SELECT * FROM Bicycle;
   ```

### Запуск запросов анализа

1. Для запуска запроса о спортивных мотоциклах:
   ```
   psql -d your_database -f vehicles/1.sql
   ```
   Ожидаемый результат: Мотоцикл Yamaha YZF-R1

2. Для запуска комбинированного запроса по транспортным средствам:
   ```
   psql -d your_database -f vehicles/2.sql
   ```
   Ожидаемые результаты: Комбинированный список транспортных средств, соответствующих указанным критериям,
   отсортированный по мощности

3. Для запуска запроса статистики по типам транспортных средств:
   ```
   psql -d your_database -f vehicles/3.sql
   ```
   Ожидаемые результаты: Статистика по средней цене и мощности для каждого производителя, сгруппированная по типу транспортного средства

### Тестирование

Вы можете протестировать базу данных следующими способами:

1. Добавление новых транспортных средств и проверка ограничений
2. Изменение запросов для проверки различных критериев фильтрации
3. Создание собственных запросов для извлечения конкретной информации
